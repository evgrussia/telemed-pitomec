---
title: "Threat Model & Security Requirements: Телемед-Питомец"
created_by: "Security Agent"
created_at: "2026-01-28"
version: "1.0"
---

# Threat Model & Security Requirements: Телемед-Питомец

## 1. Обзор
Данный документ описывает модель угроз и требования к безопасности для сервиса «Телемед-Питомец». Основное внимание уделяется защите персональных данных владельцев, медицинских данных питомцев и обеспечению конфиденциальности видеоконсультаций.

## 2. Активы (Assets)
| Актив | Описание | Классификация |
|-------|-------------|----------------|
| Персональные данные (PII) | Имена, Telegram ID, контактные данные | Конфиденциально |
| Медицинские карты | История болезни питомца, результаты ИИ-диагностики, назначения | Конфиденциально |
| Видео-трафик | Поток данных во время консультаций | Строго конфиденциально |
| Данные авторизации | Telegram InitData, JWT токены | Конфиденциально |

## 3. Модель угроз (STRIDE)

### 3.1 Анализ ключевых угроз

| Угроза | STRIDE | Риск | Минимизация (Mitigation) |
|--------|--------|------|------------|
| **Подмена медицинских данных** | Tampering | Высокий | Использование цифровых подписей (HMAC) для внутренних API, версионирование записей, аудит-логи изменений. |
| **Несанкционированный доступ к мед. картам** | Elevation of Privilege | Критический | Строгая ролевая модель (RBAC), проверка владения ресурсом (IDOR checks) на уровне бэкенда. |
| **Перехват видео-трафика** | Information Disclosure | Высокий | Использование WebRTC с обязательным шифрованием (DTLS/SRTP), TLS 1.3 для сигнального трафика. |
| **Спуфинг пользователя (подмена личности)** | Spoofing | Средний | Валидация `hash` в Telegram InitData на стороне сервера, использование короткоживущих JWT. |
| **Отказ в обслуживании (DDoS)** | Denial of Service | Средний | Rate limiting на уровне API Gateway (Nginx/Cloudflare), фильтрация трафика. |

## 4. Требования к безопасности

### 4.1 Аутентификация и авторизация
*   **Telegram InitData:** Каждый запрос от WebApp должен содержать `webapp_data` в заголовках. Бэкенд ОБЯЗАН проверять подпись данных (`hash`) с использованием `BOT_TOKEN` согласно документации Telegram.
*   **Сессии:** Использование JWT (JSON Web Tokens). Access token (15-30 мин), Refresh token (7 дней, хранится в HttpOnly куках).
*   **Ролевая модель (RBAC):**
    *   `Owner` (Владелец): доступ только к своим питомцам и их истории.
    *   `Veterinarian` (Ветеринар): доступ к данным питомца только на время активной консультации или при наличии записи.
    *   `Administrator` (Админ): доступ к управлению справочниками, без прямого доступа к видео-трафику.

### 4.2 Защита данных (Data Protection)
*   **Encryption in Transit:**
    *   Обязательное использование HTTPS (TLS 1.3) для всех API-запросов.
    *   HSTS (HTTP Strict Transport Security) включен.
*   **Encryption at Rest:**
    *   Шифрование базы данных (PostgreSQL) на уровне диска (AES-256).
    *   Чувствительные медиафайлы (фото симптомов) в S3 должны быть зашифрованы и доступны только по временным подписанным ссылкам (Signed URLs).
*   **Маскирование данных:** Персональные данные должны маскироваться в логах разработки и мониторинга.

### 4.3 Безопасность видеосвязи
*   Использование протоколов WebRTC с обязательным сквозным шифрованием (E2EE) или защищенным транспортным слоем (SRTP).
*   Динамическая генерация комнат (Room IDs) с ограниченным временем жизни.

## 5. План действий при инцидентах (Incident Response Plan)

### 5.1 Классификация инцидентов
*   **Низкий:** Попытки подбора паролей, единичные ошибки валидации.
*   **Средний:** Успешная DoS-атака, сбои в системе авторизации.
*   **Высокий:** Утечка персональных данных, несанкционированный доступ к мед. картам, компрометация ключей шифрования.

### 5.2 Алгоритм реагирования
1.  **Обнаружение (Detection):** Мониторинг аномалий (Sentry, ELK, Prometheus).
2.  **Сдерживание (Containment):** Изоляция скомпрометированных узлов, отзыв JWT-токенов, смена API-ключей.
3.  **Искоренение (Eradication):** Закрытие уязвимости, патчинг кода, очистка системы от вредоносного ПО.
4.  **Восстановление (Recovery):** Восстановление данных из бэкапов (при необходимости), запуск сервисов.
5.  **Анализ (Post-mortem):** Составление отчета, внесение изменений в модель угроз.

### 5.3 Уведомление
*   При утечке PII/медицинских данных — уведомление пользователей в течение 72 часов согласно ФЗ-152 / GDPR.

---
*Документ создан: Security Agent | Дата: 2026-01-28*

---
✍️ **Security Agent**
